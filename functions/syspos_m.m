function [sys] = syspos_m(p, v, q, varQ, varR, tau, T)

lambda  = p(1);
phi     = p(2);
h       = p(3);

vN = v(1);
vE = v(2);
vD = v(3);

Rlambda = Rlambda_m(lambda);
Rphi = Rphi_m(lambda);
RT = rot(q)';

F(1,1) = 0;
F(1,2) = 0;
F(1,3) = -(vN)/(Rlambda + h)^2;
F(2,1) =  (vE*sin(lambda))/((Rphi + h)*cos(lambda)^2);
F(2,2) = 0;
F(2,3) = -(vE)/((Rphi + h)^2*cos(lambda));
F(3,1) = 0; 
F(3,2) = 0;
F(3,3) = 0;

F(1,4) = inv(Rlambda + h);
F(1,5) = 0;
F(1,6) = 0;
F(2,4) = 0;
F(2,5) = inv((Rphi + h)*cos(lambda));
F(2,6) = 0;
F(3,4) = 0;
F(3,5) = 0;
F(3,6) = -1;

F(1:3, 7:9) = zeros(3,3);

F(4,1) = -(vE)^2/(Rphi + h) - (vE^2*sin(lambda)^2)/((Rphi + h)*cos(lambda)^2);
F(4,2) = 0;
F(4,3) = (vE^2*sin(lambda))/((Rphi + h)^2*cos(lambda)) -(vN*vD)/((Rlambda + h)^2);
F(5,1) = (vE*vN) /(Rphi + h) + (vE*vN*(sin(lambda)^2))/((Rphi + h)*(cos(lambda)^2));
F(5,2) = 0;
F(5,3) = -((vE*vN)*sin(lambda))/((Rphi + h)^2*cos(lambda)) - (vE*vD)/((Rphi + h)^2);
F(6,1) = 0;
F(6,2) = 0;
F(6,3) = (vE^2)/((Rphi + h)^2) + (vN^2)/((Rlambda + h)^2);

F(4,4) = vD/(Rlambda + h);
F(4,5) = -(2*vE*sin(lambda))/((Rphi + h)*cos(lambda));
F(4,6) = vN/(Rlambda + h);
F(5,4) = (vE*sin(lambda))/((Rphi + h)*cos(lambda));
F(5,5) = (vN*sin(lambda))/((Rphi + h)*cos(lambda)) + vD/(Rphi + h);
F(5,6) = vE/(Rphi + h);
F(6,4) = -(2*vN)/(h);
F(6,5) = -(2*vE)/(Rphi + h);
F(6,6) = 0;

F(4:6, 7:9) = -RT;

F(7:9, 1:6) = zeros(3,6);

F(7:9, 7:9) = -diag(1./tau);

Phi = 1*eye(9) + F*T;



L = [ zeros(6,3); RT];

G = [ zeros(3,6); 
      -RT, zeros(3,3); 
      zeros(3,3), eye(3,3)];

H = [ eye(6,6), zeros(6,3)];

        
E = diag(varQ);
         
Q = G*E*G'*T;

R = diag(varR);

Ef = [ 0 0 8.6518448575533743e-029 6.9770885612170754e-017 0 0 0 0 0 ; 
1.4287232607684019e-015 0 1.2447232512488922e-028 0 8.0235026059619446e-017 0 0 0 0 ; 
0 0 0 0 0 0.0048467315716272576 0 0 0 ; 
1.3419798263717305e-013 0 2.6307940197713262e-028 8.7953645040105456e-016 4.9124972178940882e-015 6.0101195411087961e-015 0.15833602031753119 0.055399136600360326 0.020535612493901633 ; 
1.5752745071652574e-014 0 5.0230881702614319e-029 1.2281243044735221e-015 1.5702369259163797e-015 7.5189289898952656e-015 0.055441611614859838 0.16725670231452638 0.0021191568441892034 ; 
0 0 1.7660288223281591e-027 2.4340445898035342e-006 3.0075715959581062e-014 0 0.0026292483570886692 0.0021191568441892034 0.0043854455861159387 ; 
0 0 0 0 0 0 8.2592255044468662e-008 0 0 ; 
0 0 0 0 0 0 0 2.8384398844185659e-010 0 ; 
0 0 0 0 0 0 0 0 2.4536583488697674e-010 ]; 

Eg = [ 0 0 0 0 0 0 ; 
0 0 0 0 0 0 ; 
0 0 0 0 0 0 ; 
0.6755166781275751 0.23380865986478375 0.086803728739753533 0 0 0 ; 
0.23511438553072692 0.71236956254659978 0.0084971391152168316 0 0 0 ; 
0.008621263625382708 0.0084971391152168316 0.0012944780053323755 0 0 0 ; 
0 0 0 0 0 0 ; 
0 0 0 0 0 0 ; 
0 0 0 0 0 0 ]; 

Eh = [ 0 0 0 0 0 0 0 0 0 ; 
0 0 0 0 0 0 0 0 0 ; 
0 0 0 0 0 0 0 0 0 ; 
0 0 0 0 0 0 0 0 0 ; 
0 0 0 0 0 0 0 0 0 ; 
0 0 0 0 0 0 0 0 0 ]; 

M = 1e-8*[ 1 0 0 0 0 0 0 0 0 ; 
0 1 0 0 0 0 0 0 0 ; 
0 0 1 0 0 0 0 0 0 ; 
0 0 0 1 0 0 0 0 0 ; 
0 0 0 0 1 0 0 0 0 ; 
0 0 0 0 0 1 0 0 0 ; 
0 0 0 0 0 0 1 0 0 ; 
0 0 0 0 0 0 0 1 0 ; 
0 0 0 0 0 0 0 0 1 ]; 

Mf = M;
Mh = 0*eye(6);

% a = -1;
% b = 1;
% delta  = a + (b-a).*rand;
% deltaPhi = M*delta*Ef;
% deltaG = M*delta*Eg;
% 
% Phi = Phi + deltaPhi;
% G = G + deltaG;

sys.Phi = Phi;
sys.L = L;
sys.G = G;
sys.H = H;
sys.Q = Q;
sys.Qeta = E;
sys.R = R;
sys.alfa = 1000; % Sayed
% sys.alfa = 0.1;
% sys.alfa = 1;
sys.Ef = Ef;
sys.Eg = Eg;
sys.Eh = Eh;
sys.M = M;
sys.Mf = Mf;
sys.Mh = Mh;
             